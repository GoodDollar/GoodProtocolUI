import{S as t,H as r,I as n,aa as o,x as e,ab as i,q as a,n as s,t as u,a2 as c,a6 as m}from"./tokens.js";import{a as l}from"./compoundPrice.js";import{i as d,d as f}from"./isTradeBetter.js";import{B as v}from"./misc.js";import{m as p}from"./tokenLists.js";import{g as x}from"./getContract.js";import{t as b}from"./tokenBalance.js";import{C as h}from"./ContributionCalcContract.js";import{b as j,d as w,a as A}from"./debug.js";function C(e,i,a){var s,u,c=void 0===a?{}:a,m=c.maxHops,f=void 0===m?2:m,p=c.chainId,x=void 0===p?t.MAINNET:p;return r(this,void 0,void 0,(function(){var t,r,a,c;return n(this,(function(n){switch(n.label){case 0:return[4,l(x,e,null==i?void 0:i.currency)];case 1:if(t=n.sent(),e&&i&&t.length>0){if(1===f)return[2,null!==(s=o.bestTradeExactOut(t,e,i,{maxHops:1,maxNumResults:1})[0])&&void 0!==s?s:null];for(r=null,a=1;a<=f;a++)c=null!==(u=o.bestTradeExactOut(t,e,i,{maxHops:a,maxNumResults:1})[0])&&void 0!==u?u:null,d(r,c,v)&&(r=c);return[2,r]}return[2,null]}}))}))}var D=p((function(t,o){return r(void 0,void 0,void 0,(function(){var r,c,m,l,d,v;return n(this,(function(n){switch(n.label){case 0:return r=x(o,"GoodReserveCDai",["function currentPrice() view returns (uint256)","function currentPriceDAI() view returns (uint256)"],t),[4,Promise.all([r.currentPrice(),r.currentPriceDAI()])];case 1:return c=e.apply(void 0,[n.sent(),2]),m=c[0],l=c[1],f(D),d=new i(a[o],s[o],l,100),v=new i(u[o],s[o],m,100),[2,{DAI:d,cDAI:v}]}}))}))}),(function(t,r){return r})),E=m;function I(t,o,e){return r(this,void 0,void 0,(function(){var r,i,a,s,u;return n(this,(function(n){switch(n.label){case 0:return[4,h(t)];case 1:return r=n.sent(),A("Exit contribution"),w("G$",o.toFixed(2)),[4,b(t,"GDX",e)];case 2:return i=n.sent(),a=c.fromFractionalAmount(o.currency,i.numerator,i.denominator),w("GDX",a.toFixed(2)),s=o.subtract(o.lessThan(a)?o:a),w("G$ discount",s.toFixed(2)),s.equalTo(0)?(j("Exit contribution"),[2,c.fromRawAmount(o.currency,"0")]):[4,r.methods.calculateContribution(E,E,E,E,s.multiply(s.decimalScale).toExact()).call()];case 3:return u=n.sent(),j("Exit contribution"),[2,c.fromRawAmount(o.currency,u.toString())]}}))}))}export{I as c,D as g,C as v};
