import{H as n,I as r,x as e,_ as t,S as o,a9 as a,a2 as s,J as i,a as u,Z as l,Q as c,aa as d,a1 as f}from"./tokens.js";import{m as v,f as m,a as p,g as h}from"./tokenLists.js";import{B as b,A as I,C as y}from"./routing.js";import{P as g,c as w,a as S}from"./PairContract.js";import{c as x,d as T,i as k}from"./isTradeBetter.js";import{B}from"./misc.js";import{d as A}from"./debug.js";var E,j=v((function(a,s,i){return n(void 0,void 0,void 0,(function(){var n,u,l,c,d,f,v,h,g,w,S,x,T,k,B;return r(this,(function(r){switch(r.label){case 0:return n=e(a?[null==s?void 0:s.wrapped,null==i?void 0:i.wrapped]:[void 0,void 0],2),u=n[0],l=n[1],c=[],a&&(d=null!==(S=b[a])&&void 0!==S?S:[],f=u&&null!==(T=null===(x=I[a])||void 0===x?void 0:x[u.address])&&void 0!==T?T:[],v=l&&null!==(B=null===(k=I[a])||void 0===k?void 0:k[l.address])&&void 0!==B?B:[],c=t(t(t([],e(d),!1),e(f),!1),e(v),!1)),a!==o.FUSE?[3,2]:[4,p(o.FUSE)];case 1:h=e.apply(void 0,[r.sent(),1]),g=h[0],c=t(t([],e(c),!1),e(Array.from(g.values())),!1),r.label=2;case 2:return w=m(c,(function(n){return c.map((function(r){return[n,r]}))})),[2,u&&l?t(t(t([[u,l]],e(c.map((function(n){return[u,n]}))),!1),e(c.map((function(n){return[l,n]}))),!1),e(w),!1).filter((function(n){return Boolean(n[0]&&n[1])})).filter((function(n){var r=e(n,2),t=r[0],o=r[1];return t.address!==o.address})).filter((function(n){var r=e(n,2),t=r[0],o=r[1];if(!a)return!0;var s=y[a],i=null==s?void 0:s[t.address],u=null==s?void 0:s[o.address];return!i&&!u||!(i&&!i.find((function(n){return o.equals(n)})))&&!(u&&!u.find((function(n){return t.equals(n)})))})):[]]}}))}))}),(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n[0]+n[1].symbol+n[2].symbol}));function C(t,o){return n(this,void 0,void 0,(function(){var n,d,f,v,m,p,h,b,I,y;return r(this,(function(r){switch(r.label){case 0:n=o.map((function(n){var r=e(n,2),t=r[0],o=r[1];return[t.wrapped,o.wrapped]})),d=n.reduce((function(n,r){var t=e(r,2),o=t[0],a=t[1],s=o.chainId===a.chainId&&!o.equals(a)&&u[o.chainId]?x(o.chainId,o,a).toLowerCase():void 0;return s&&n.set(s,[o,a]),n}),new Map),f=[],v=function(n){f.push(g(t,n).getReserves().then((function(r){var t=e(d.get(n),2),o=t[0],a=t[1];return c(c({},r),{tokenA:o,tokenB:a})})))};try{for(m=l(d.keys()),p=m.next();!p.done;p=m.next())h=p.value,v(h)}catch(n){I={error:n}}finally{try{p&&!p.done&&(y=m.return)&&y.call(m)}finally{if(I)throw I.error}}return[4,Promise.allSettled(f)];case 1:return b=r.sent(),[2,b.filter((function(n){return"fulfilled"===n.status})).map((function(n){return n.value})).map((function(n){var r=n.reserve0,t=n.reserve1,o=n.tokenA,u=n.tokenB;if(!o||!u||o.equals(u))return[E.INVALID,null];var l=e(o.sortsBefore(u)?[o,u]:[u,o],2),c=l[0],d=l[1];return[E.EXISTS,new a(s.fromRawAmount(c,i.BigInt(r.toString())),s.fromRawAmount(d,i.BigInt(t.toString())))]}))]}}))}))}!function(n){n[n.EXISTS=0]="EXISTS",n[n.INVALID=1]="INVALID"}(E||(E={}));var N=v((function(t,o,a){return n(void 0,void 0,void 0,(function(){var n,s;return r(this,(function(r){switch(r.label){case 0:return[4,j(t,o,a)];case 1:return n=r.sent(),[4,C(t,n)];case 2:return s=r.sent(),console.log("v2Pairs",{allPairs:s}),T(N),[2,Object.values(s.filter((function(n){return Boolean(n[0]===E.EXISTS&&n[1])})).reduce((function(n,r){var t,o=e(r,2)[1];return n[o.liquidityToken.address]=null!==(t=n[o.liquidityToken.address])&&void 0!==t?t:o,n}),{}))]}}))}))}),(function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n[0]+n[1].symbol+n[2].symbol}));function P(e,t,a){var s,i,u=void 0===a?{}:a,l=u.maxHops,c=void 0===l?2:l,f=u.chainId,v=void 0===f?o.MAINNET:f;return n(this,void 0,void 0,(function(){var n,o,a,u;return r(this,(function(r){switch(r.label){case 0:return[4,N(v,null==e?void 0:e.currency,t)];case 1:if(n=r.sent(),A(n.map((function(n){return[n.token0.symbol,n.token0.address,n.token1.symbol,n.token1.address]}))),e&&t&&n.length>0){if(1===c)return[2,null!==(s=d.bestTradeExactIn(n,e,t,{maxHops:1,maxNumResults:1})[0])&&void 0!==s?s:null];for(o=null,a=1;a<=c;a++)u=null!==(i=d.bestTradeExactIn(n,e,t,{maxHops:a,maxNumResults:3})[0])&&void 0!==i?i:null,console.log({currentTrade:u,maxHops:c}),k(o,u,B)&&(console.log("found trade better --\x3e"),o=u);return console.log({bestTradeSoFar:o}),[2,o]}return[2,null]}}))}))}var R=v((function(e){return n(void 0,void 0,void 0,(function(){var n;return r(this,(function(r){switch(r.label){case 0:return[4,w(e)];case 1:return[4,r.sent().methods.exchangeRateCurrent().call()];case 2:return n=r.sent(),T(R),[2,new f(n,1e28)]}}))}))}),(function(n,r){return r})),q=v((function(t,o){return n(void 0,void 0,void 0,(function(){var n,a,s,i,u;return r(this,(function(r){switch(r.label){case 0:return[4,Promise.all([S(t,o),h(t,o)])];case 1:return n=e.apply(void 0,[r.sent(),2]),a=n[0],s=n[1],i=1e28,"cUSDC"===s.symbol||"cUSDT"===s.symbol?i=1e16:"cWBTC"===s.symbol&&(i=1e18),[4,a.methods.exchangeRateCurrent().call()];case 2:return u=r.sent(),T(q),[2,new f(u,i)]}}))}))}),(function(n,r,e){return e}));export{E as P,N as a,j as b,R as c,q as d,P as e,C as v};
